CREATE INDEX ind_srid ON CourseRegistrations(StudentRegistrationId);
CREATE MATERIALIZED VIEW Info(StudentRegistrationId, GPA, ObtainedECTS, Failed) AS (SELECT cr.StudentRegistrationId, SUM(case when Grade >= 5 then cr.Grade * c.ECTS end)/SUM(case when Grade >= 5 then ECTS*1.0 end), SUM(case when Grade >= 5 then ECTS end), MIN(Grade) FROM CourseRegistrations cr, CourseOffers co, Courses c WHERE cr.CourseOfferId = co.CourseOfferId AND co.courseId = c.courseId GROUP BY cr.StudentRegistrationId);
